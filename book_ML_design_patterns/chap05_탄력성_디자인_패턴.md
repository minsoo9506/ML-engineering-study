# 5. 탄력성 디자인 패턴

- 모델을 학습 시킨 후 production 환경에 배포하고 서비스를 제공한다. 이와 관련한 디자인 패턴을 배운다.

## 5.1 디자인 패턴 16: stateless serving function

- 초당 수천~수백만 개의 예측 요청을 동기식으로 처리할 수 있다.
- 이와 같은 production ML system은 stateless function 중심으로 설계된다.
- stateless function?
  - input에 의해 출력이 결정되는 함수

```python
def stateless_fuc(x):
    return 2 * x + 10
```

### 5.1.2 솔루션

1. 가능하면 프로그래밍 언어에 구애받지 않는 형식으로 모델을 내보낸다.
   - 모델 내보내기: 수학적 핵심을 유지한 채 내보낸다. (최소한의 정보) ONNX 포맷처럼 많이들 사용하는 방법을 이용하자.
2. 모델의 순뱡향 계산으로만 구성된 공식을 stateless function으로 만든다.
3. stateless functioin은 REST endpoint를 제공하는 프레임워크에 배포된다.

## 5.2 디자인 패턴 17: batch serving

- 한 번에 많은 instance에 대한 추론을 수행

## 5.3 디자인 패턴 18: continued model evaluation

- 배포를 했다고 모델을 완성시킨게 아니다.
- 잘 작동하는지 계속 확인해야 한다.
- 모델 배포 -> 예측 저장 -> 정답 수집 -> 모델 성능 평가 -> 지속적인 평가

### 5.3.4 trade-off와 대안

- 모델을 모니터링하고 모델을 최신 상태로 유지하는게 목표
  - 재학습을 위한 트리거 설정: 각 상황에 맞춰서 특정 값이 되면 재학습
  - 예정된 재학습
  - TFX를 활용한 데이터 검증
  - 재학습 간격 추정: 예를 들어, 1년전 데이터로 모델을 학습시키고 최근 데이터로 성능을 평가&비교해본다. 모델의 성능이 얼마나 떨어지고 재학습이 필요한 빈도를 추정할 수 있다.

## 5.4 디자인 패턴 19: two-phase prediction

- 예를 들어, 멸종위기에 처한 동물을 식별하는 카메라가 있다고 하자. 먼저 카메라에 멸종위기 동물이 있는지 없는지만 판단하는 작은 모델이 있고 있다고 예측한 경우만 클라우드에 있는 모델로 데이터를 보내서 어떤 동물인지 분류해 판단한다.

## 5.5 디자인 패턴 20: keyed prediction

- input instance마다 고유 key를 같이 넣고 모델의 output마다 key와 쌍을 이뤄서 나오게 한다.
- 그러면 output의 순서가 뒤섞여도 input과 key로 매칭할 수 있다.
